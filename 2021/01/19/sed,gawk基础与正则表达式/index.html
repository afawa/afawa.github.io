<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>sed,gawk基础与正则表达式 - Yiming&#039;s Blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Yiming&#039;s Blog"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Yiming&#039;s Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="sed基础，gawk基础，正则表达式sed 编辑器sed简单应用sed编辑器被称为流编辑器，流编辑器会在编辑器处理数据之前基于预先提供的一组规则来编辑数据流。sed可以根据命令来处理数据流中的数据，这些命令要么从命令行中输入，要么存储在一个命令文本文件中。sed编辑器会执行下列操作。  一次从输入中读取一行数据 根据所提供的编辑器命令匹配数据 按照命令修改流中的数据 将新的数据输出到STDOUT"><meta property="og:type" content="blog"><meta property="og:title" content="sed,gawk基础与正则表达式"><meta property="og:url" content="https://afawa.github.io/2021/01/19/sed,gawk%E5%9F%BA%E7%A1%80%E4%B8%8E%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/"><meta property="og:site_name" content="Yiming&#039;s Blog"><meta property="og:description" content="sed基础，gawk基础，正则表达式sed 编辑器sed简单应用sed编辑器被称为流编辑器，流编辑器会在编辑器处理数据之前基于预先提供的一组规则来编辑数据流。sed可以根据命令来处理数据流中的数据，这些命令要么从命令行中输入，要么存储在一个命令文本文件中。sed编辑器会执行下列操作。  一次从输入中读取一行数据 根据所提供的编辑器命令匹配数据 按照命令修改流中的数据 将新的数据输出到STDOUT"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://afawa.github.io/img/og_image.png"><meta property="article:published_time" content="2021-01-19T14:12:17.000Z"><meta property="article:modified_time" content="2021-01-20T08:12:12.576Z"><meta property="article:author" content="Yiming He"><meta property="article:tag" content="linux command line"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://afawa.github.io/2021/01/19/sed,gawk%E5%9F%BA%E7%A1%80%E4%B8%8E%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/"},"headline":"Yiming's Blog","image":["https://afawa.github.io/img/og_image.png"],"datePublished":"2021-01-19T14:12:17.000Z","dateModified":"2021-01-20T08:12:12.576Z","author":{"@type":"Person","name":"Yiming He"},"description":"sed基础，gawk基础，正则表达式sed 编辑器sed简单应用sed编辑器被称为流编辑器，流编辑器会在编辑器处理数据之前基于预先提供的一组规则来编辑数据流。sed可以根据命令来处理数据流中的数据，这些命令要么从命令行中输入，要么存储在一个命令文本文件中。sed编辑器会执行下列操作。  一次从输入中读取一行数据 根据所提供的编辑器命令匹配数据 按照命令修改流中的数据 将新的数据输出到STDOUT"}</script><link rel="canonical" href="https://afawa.github.io/2021/01/19/sed,gawk%E5%9F%BA%E7%A1%80%E4%B8%8E%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-dark.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.3.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="Yiming&#039;s Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2021-01-19T14:12:17.000Z" title="2021-01-19T14:12:17.000Z">2021-01-19</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-01-20T08:12:12.576Z" title="2021-01-20T08:12:12.576Z">2021-01-20</time></span><span class="level-item"><a class="link-muted" href="/categories/linux-command-line/">linux command line</a></span><span class="level-item">33 minutes read (About 4914 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">sed,gawk基础与正则表达式</h1><div class="content"><h1 id="sed基础，gawk基础，正则表达式"><a href="#sed基础，gawk基础，正则表达式" class="headerlink" title="sed基础，gawk基础，正则表达式"></a><code>sed</code>基础，<code>gawk</code>基础，正则表达式</h1><h2 id="sed-编辑器"><a href="#sed-编辑器" class="headerlink" title="sed 编辑器"></a><code>sed</code> 编辑器</h2><h3 id="sed简单应用"><a href="#sed简单应用" class="headerlink" title="sed简单应用"></a><code>sed</code>简单应用</h3><p><code>sed</code>编辑器被称为流编辑器，流编辑器会在编辑器处理数据之前基于预先提供的一组规则来编辑数据流。<code>sed</code>可以根据命令来处理数据流中的数据，这些命令要么从命令行中输入，要么存储在一个命令文本文件中。<code>sed</code>编辑器会执行下列操作。</p>
<ol>
<li>一次从输入中读取一行数据</li>
<li>根据所提供的编辑器命令匹配数据</li>
<li>按照命令修改流中的数据</li>
<li>将新的数据输出到<code>STDOUT</code></li>
</ol>
<a id="more"></a>

<p><code>sed</code>命令的格式如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed options script file</span><br></pre></td></tr></table></figure>
<p>根据选项可以修改<code>sed</code>命令的行为，</p>
<ol>
<li><code>-n</code>。不产生命令输出，使用<code>print</code>命令来完成输出。</li>
<li><code>-e script</code>。在处理输入时，将script中指定的命令添加到已有的命令中。（命令行输入，多个<code>-e script</code>组合）</li>
<li><code>-f file</code>。在处理输入时，将file中指定的命令添加到已有的命令中。（文件输入）</li>
<li><code>-i</code>。之间编辑文件命令。</li>
</ol>
<h4 id="在命令行定义编辑器命令"><a href="#在命令行定义编辑器命令" class="headerlink" title="在命令行定义编辑器命令"></a>在命令行定义编辑器命令</h4><p>默认情况下，<code>sed</code>编辑器会将指定的命令应用到<code>STDIN</code>输入流上。可以直接通过管道输入<code>sed</code>编辑器进行处理。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;This is a test&quot;</span> | sed <span class="string">&#x27;s/test/big test/&#x27;</span> </span><br><span class="line">This is a big <span class="built_in">test</span></span><br><span class="line">$ </span><br></pre></td></tr></table></figure>
<p>在上面的示例中使用管道对<code>sed</code>编辑器输入文本，然后使用<code>s</code>命令对于文本进行替换，这里的<code>s/test/big test/</code>代表把test全部替换成big test。</p>
<p><code>sed</code>编辑器不会修改文本文件的数据，它只会将修改后的数据发送到<code>STDOUT</code>中。</p>
<h4 id="在命令行使用多个编辑器命令"><a href="#在命令行使用多个编辑器命令" class="headerlink" title="在命令行使用多个编辑器命令"></a>在命令行使用多个编辑器命令</h4><p>要在<code>sed</code>命令行上执行多个命令时，使用<code>-e</code>选项</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$ cat data1.txt</span><br><span class="line">The quick brown fox jumps over the lazy dog.</span><br><span class="line">The quick brown fox jumps over the lazy dog.</span><br><span class="line">The quick brown fox jumps over the lazy dog.</span><br><span class="line">The quick brown fox jumps over the lazy dog.</span><br><span class="line">$ sed -e <span class="string">&#x27;s/brown/green/; s/dog/cat/&#x27;</span> data1.txt</span><br><span class="line">The quick green fox jumps over the lazy cat.</span><br><span class="line">The quick green fox jumps over the lazy cat.</span><br><span class="line">The quick green fox jumps over the lazy cat.</span><br><span class="line">The quick green fox jumps over the lazy cat.</span><br><span class="line">$ sed -e <span class="string">&#x27;s/brown/green/&#x27;</span> -e <span class="string">&#x27;s/dog/cat/&#x27;</span> data1.txt</span><br><span class="line">The quick green fox jumps over the lazy cat.</span><br><span class="line">The quick green fox jumps over the lazy cat.</span><br><span class="line">The quick green fox jumps over the lazy cat.</span><br><span class="line">The quick green fox jumps over the lazy cat.</span><br><span class="line">$ sed -e <span class="string">&#x27;</span></span><br><span class="line"><span class="string">&gt; s/brown/green/</span></span><br><span class="line"><span class="string">&gt; s/dog/cat/</span></span><br><span class="line"><span class="string">&gt; &#x27;</span> data1.txt</span><br><span class="line">The quick green fox jumps over the lazy cat.</span><br><span class="line">The quick green fox jumps over the lazy cat.</span><br><span class="line">The quick green fox jumps over the lazy cat.</span><br><span class="line">The quick green fox jumps over the lazy cat.</span><br></pre></td></tr></table></figure>
<p>注意使用分号时在命令末尾和分号之间不能有空格。如果使用多行模式必须在封尾单引号所在行结束命令。</p>
<h4 id="从文件读取编辑器命令"><a href="#从文件读取编辑器命令" class="headerlink" title="从文件读取编辑器命令"></a>从文件读取编辑器命令</h4><p>如果有大量要处理的<code>sed</code>命令，可以使用<code>-f</code>选项从文件中读取。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ cat script1.sed</span><br><span class="line">s/brown/green/</span><br><span class="line">s/dog/cat/</span><br><span class="line">$ sed -f script1.sed data1.txt</span><br><span class="line">The quick green fox jumps over the lazy cat.</span><br><span class="line">The quick green fox jumps over the lazy cat.</span><br><span class="line">The quick green fox jumps over the lazy cat.</span><br><span class="line">The quick green fox jumps over the lazy cat.</span><br></pre></td></tr></table></figure>
<h3 id="sed编辑器基础"><a href="#sed编辑器基础" class="headerlink" title="sed编辑器基础"></a><code>sed</code>编辑器基础</h3><h4 id="更多的替换选项"><a href="#更多的替换选项" class="headerlink" title="更多的替换选项"></a>更多的替换选项</h4><ol>
<li><p>替换标记。上面使用的默认形式<code>s/dog/cat/</code>这种形式默认只会替换每行的第一个出现的<code>dog</code>。事实上，要让替换命令能够替换一行中不同地方出现的文本必须使用替换标记。替换标记会在替换命令字符串之后设置。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s/pattern/replacement/flags</span><br></pre></td></tr></table></figure>
<p>有四种可用的替换标记</p>
<ol>
<li>数字，表明新文本将替换第几次模式匹配的地方。</li>
<li><code>g</code>，表明新文本会替换所有的匹配文本。</li>
<li><code>p</code>，表明原先行的内容要打印出来。</li>
<li><code>w file</code>，将替换的结果写到文件中。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ cat data4.txt</span><br><span class="line">This is a <span class="built_in">test</span> of the <span class="built_in">test</span> script</span><br><span class="line">This is the second <span class="built_in">test</span> of the <span class="built_in">test</span> script</span><br><span class="line">$ sed <span class="string">&#x27;s/test/trail/2&#x27;</span> data4.txt</span><br><span class="line">This is a <span class="built_in">test</span> of the trail script</span><br><span class="line">This is the second <span class="built_in">test</span> of the trail script</span><br><span class="line">$ sed <span class="string">&#x27;s/test/trail/g&#x27;</span> data4.txt</span><br><span class="line">This is a trail of the trail script</span><br><span class="line">This is the second trail of the trail script</span><br><span class="line">$ sed <span class="string">&#x27;s/test/trail/gw temp&#x27;</span> data4.txt</span><br><span class="line">This is a trail of the trail script</span><br><span class="line">This is the second trail of the trail script</span><br><span class="line">$ cat temp</span><br><span class="line">This is a trail of the trail script</span><br><span class="line">This is the second trail of the trail script</span><br></pre></td></tr></table></figure>
<p><code>p</code>替换标记会输出修改过的行，一般和<code>sed</code>的<code>-n</code>选项一起使用。注意<code>sed</code>编辑器的正常输出在<code>STDOUT</code>中，只有那些包含匹配模式的行才会被<code>w</code>替换选项保存。</p>
</li>
<li><p>替换字符。替换文件中的路径名可能会非常麻烦。例如</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sed <span class="string">&#x27;s/\/bin\/bash/\/bin\/csh/&#x27;</span> /etc/passwd</span><br></pre></td></tr></table></figure>
<p>要解决这个问题，<code>sed</code>编辑器允许选择其他字符来作为替换命令的字符串分隔符</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sed <span class="string">&#x27;s!/bin/bash!/bin/csh!&#x27;</span> /etc/passwd</span><br></pre></td></tr></table></figure>
<h4 id="使用地址"><a href="#使用地址" class="headerlink" title="使用地址"></a>使用地址</h4></li>
</ol>
<p>默认情况下，<code>sed</code>会处理所有行。如果只想命令作用于特定行或某些行，则必须使用行寻址。有两种行寻址方式。两种形式都使用相同的格式来指定地址。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[address]<span class="built_in">command</span></span><br><span class="line"></span><br><span class="line">address &#123;</span><br><span class="line">	command1</span><br><span class="line">	command2</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li><p>以数字形式表示行区间。</p>
<ol>
<li><p>用单个行号指定一行。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ sed <span class="string">&#x27;2s/dog/cat/&#x27;</span> data1.txt</span><br><span class="line">The quick brown fox jumps over the lazy dog.</span><br><span class="line">The quick brown fox jumps over the lazy cat.</span><br><span class="line">The quick brown fox jumps over the lazy dog.</span><br><span class="line">The quick brown fox jumps over the lazy dog.</span><br><span class="line">$ </span><br></pre></td></tr></table></figure></li>
<li><p>使用行号区间，起始行号+逗号+结束行号。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ sed <span class="string">&#x27;1,3s/dog/cat/&#x27;</span> data1.txt</span><br><span class="line">The quick brown fox jumps over the lazy cat.</span><br><span class="line">The quick brown fox jumps over the lazy cat.</span><br><span class="line">The quick brown fox jumps over the lazy cat.</span><br><span class="line">The quick brown fox jumps over the lazy dog.</span><br><span class="line">$ sed <span class="string">&#x27;2,$s/dog/cat/&#x27;</span> data1.txt</span><br><span class="line">The quick brown fox jumps over the lazy dog.</span><br><span class="line">The quick brown fox jumps over the lazy cat.</span><br><span class="line">The quick brown fox jumps over the lazy cat.</span><br><span class="line">The quick brown fox jumps over the lazy cat.</span><br><span class="line">$ </span><br></pre></td></tr></table></figure>
<p>注意这里可可用使用<code>$</code>来代表最后一行。</p>
</li>
</ol>
</li>
<li><p>用文本模式过滤。<code>sed</code>编辑器允许指定文本模式来过滤出命令要作用的行。格式如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/pattern/<span class="built_in">command</span></span><br></pre></td></tr></table></figure>
<p>这里必须使用正斜线把<code>pattern</code>包裹起来。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sed <span class="string">&#x27;/quick/&#123;s/dog/cat/; s/fox/tiger/&#125;&#x27;</span> data1.txt</span><br><span class="line">The quick brown tiger jumps over the lazy cat.</span><br><span class="line">The quick brown tiger jumps over the lazy cat.</span><br><span class="line">The quick brown tiger jumps over the lazy cat.</span><br><span class="line">The quick brown tiger jumps over the lazy cat.</span><br></pre></td></tr></table></figure>
<p>这里的<code>pattern</code>都是采用正则表达式匹配的。</p>
<p>同时这种方式也可用使用区间模式。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/pattern1/,/pattern2/<span class="built_in">command</span></span><br></pre></td></tr></table></figure>
<p>这种情况下会先找到<code>pattern1</code>作为开始模式，找到后对于后面紧跟的所有行都执行命令<code>command</code>，直到遇到<code>pattern2</code>命令结束，特别需要小心的一点是可能有多个区间被匹配到，造成不可知的结果，尽量少用。</p>
</li>
<li><p>命令组合。下面是一个组合命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sed <span class="string">&#x27;/quick/&#123;s/dog/cat/; s/fox/tiger/&#125;;2,3&#123;s/cat/dog/;s/jump/run/&#125;&#x27;</span> data1.txt</span><br><span class="line">The quick brown tiger jumps over the lazy cat.</span><br><span class="line">The quick brown tiger runs over the lazy dog.</span><br><span class="line">The quick brown tiger runs over the lazy dog.</span><br><span class="line">The quick brown tiger jumps over the lazy cat.</span><br></pre></td></tr></table></figure>
<h4 id="删除行"><a href="#删除行" class="headerlink" title="删除行"></a>删除行</h4></li>
</ol>
<p>删除命令<code>d</code>它常常和上面的行寻址配合起来使用。例如</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ cat data6.txt</span><br><span class="line">This is line number 1.</span><br><span class="line">This is line number 2.</span><br><span class="line">This is line number 3.</span><br><span class="line">This is line number 4.</span><br><span class="line">$ sed <span class="string">&#x27;3d&#x27;</span> data6.txt</span><br><span class="line">This is line number 1.</span><br><span class="line">This is line number 2.</span><br><span class="line">This is line number 4.</span><br></pre></td></tr></table></figure>
<h4 id="插入和附加文本"><a href="#插入和附加文本" class="headerlink" title="插入和附加文本"></a>插入和附加文本</h4><p><code>sed</code>有两个插入操作。</p>
<ol>
<li><code>i</code>命令会在指定行前增加一个新行。</li>
<li><code>a</code>命令会在指定行后增加一个新行。</li>
</ol>
<p>格式如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;[address]command\</span></span><br><span class="line"><span class="string">new line&#x27;</span></span><br></pre></td></tr></table></figure>
<p>下面是一个例子。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ sed <span class="string">&#x27;3a\</span></span><br><span class="line"><span class="string">&gt; insert1</span></span><br><span class="line"><span class="string">&gt; 4i\</span></span><br><span class="line"><span class="string">&gt; intert2&#x27;</span> data6.txt</span><br><span class="line">This is line number 1.</span><br><span class="line">This is line number 2.</span><br><span class="line">This is line number 3.</span><br><span class="line">insert1</span><br><span class="line">intert2</span><br><span class="line">This is line number 4.</span><br><span class="line">$ </span><br></pre></td></tr></table></figure>
<p>从这个例子可以发现插入的语句是不会进入行计算里面的。（因为这里的<code>This is line number 4.</code>一直被当作第4行）</p>
<h4 id="修改行"><a href="#修改行" class="headerlink" title="修改行"></a>修改行</h4><p><code>sed</code>中使用<code>c</code>命令来对行进行修改。格式和上面的插入相似，需要单独指定新行。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ sed <span class="string">&#x27;3c\</span></span><br><span class="line"><span class="string">&gt; New Line&#x27;</span> data6.txt</span><br><span class="line">This is line number 1.</span><br><span class="line">This is line number 2.</span><br><span class="line">New Line</span><br><span class="line">This is line number 4.</span><br><span class="line">$ </span><br></pre></td></tr></table></figure>
<p>注意对于修改行命令我们也可以使用行区间的模式，但是<code>c</code>命令会把所有行替换为一行。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sed <span class="string">&#x27;2,$c\</span></span><br><span class="line"><span class="string">&gt; New Line&#x27;</span> data6.txt</span><br><span class="line">This is line number 1.</span><br><span class="line">New Line</span><br><span class="line">$</span><br></pre></td></tr></table></figure>
<h4 id="转换命令"><a href="#转换命令" class="headerlink" title="转换命令"></a>转换命令</h4><p>转换命令<code>y</code>是唯一可以处理单个字符的<code>sed</code>编辑器命令。格式如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[address]y/inchars/outchars/</span><br></pre></td></tr></table></figure>
<p><code>y</code>会对<code>inchars</code>和<code>outchars</code>进行一一映射，注意<code>inchars</code>和<code>outchars</code>长度需要相等。下面是一个例子</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ sed <span class="string">&#x27;y/123/789/&#x27;</span> data6.txt</span><br><span class="line">This is line number 7.</span><br><span class="line">This is line number 8.</span><br><span class="line">This is line number 9.</span><br><span class="line">This is line number 4.</span><br><span class="line">$ </span><br></pre></td></tr></table></figure>
<h4 id="打印"><a href="#打印" class="headerlink" title="打印"></a>打印</h4><p>有三个命令能够用来打印数据流中的信息：</p>
<ol>
<li><p><code>p</code>命令用来打印文本行。<code>p</code>命令一般和<code>-n</code>选项组合，配合行寻址。例子如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sed -n <span class="string">&#x27;/3/&#123;p;s/line/test/p&#125;&#x27;</span> data6.txt</span><br><span class="line">This is line number 3.</span><br><span class="line">This is <span class="built_in">test</span> number 3.</span><br><span class="line">$ </span><br></pre></td></tr></table></figure></li>
<li><p><code>=</code>命令来打印行号。等号命令会打印行在数据流中的当前行号。例子如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ sed -n <span class="string">&#x27;3&#123;=;p;s/line/test/p&#125;&#x27;</span> data6.txt</span><br><span class="line">3</span><br><span class="line">This is line number 3.</span><br><span class="line">This is <span class="built_in">test</span> number 3.</span><br><span class="line">$ sed <span class="string">&#x27;=&#x27;</span> data6.txt</span><br><span class="line">1</span><br><span class="line">This is line number 1.</span><br><span class="line">2</span><br><span class="line">This is line number 2.</span><br><span class="line">3</span><br><span class="line">This is line number 3.</span><br><span class="line">4</span><br><span class="line">This is line number 4.</span><br><span class="line">$ </span><br></pre></td></tr></table></figure></li>
<li><p><code>l</code>命令用来列出行。<code>l</code>命令可以打印数据流中不可打印的<code>ASCII</code>字符。任何不可打印字符要么在其八进制前加一个反斜线，要么使用C分格命名法（例如<code>\t</code>）。</p>
</li>
</ol>
<h4 id="sed处理文件"><a href="#sed处理文件" class="headerlink" title="sed处理文件"></a><code>sed</code>处理文件</h4><ol>
<li><p>写入文件。使用<code>w</code>命令可以写入文件。格式如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[address]w filename</span><br></pre></td></tr></table></figure>
<p>将对应的行写入到文件中。</p>
</li>
<li><p>读取文件。<code>r</code>命令允许将一个独立文件的数据插入到数据流中。格式如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[address]r filename</span><br></pre></td></tr></table></figure>
<p>这个命令如果不加地址会把<code>r</code>命令指定的文件内容插入到数据流的每一行后。例子如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ sed <span class="string">&#x27;/1/r data1.txt&#x27;</span> data6.txt</span><br><span class="line">This is line number 1.</span><br><span class="line">The quick brown fox jumps over the lazy dog.</span><br><span class="line">The quick brown fox jumps over the lazy dog.</span><br><span class="line">The quick brown fox jumps over the lazy dog.</span><br><span class="line">The quick brown fox jumps over the lazy dog.</span><br><span class="line">This is line number 2.</span><br><span class="line">This is line number 3.</span><br><span class="line">This is line number 4.</span><br><span class="line">$ </span><br></pre></td></tr></table></figure>
<h2 id="gawk-程序"><a href="#gawk-程序" class="headerlink" title="gawk 程序"></a><code>gawk</code> 程序</h2></li>
</ol>
<p>虽然<code>sed</code>编辑器时非常方便自动修改文本文件的工具，但也有自身的限制。<code>gawk</code>能提供一个类编程环境来修改和重新组织文件中的数据。<code>gawk</code>提供了一种编程语言，可以做如下的事：</p>
<ol>
<li>定义变量来保存数据。</li>
<li>使用算术和字符串操作来处理数据。</li>
<li>使用结构化编程（例如<code>if-then</code>语句和循环）。</li>
<li>通过提取数据文件中的数据元素，将其重新排序或格式化，生成格式化报告。</li>
</ol>
<p><code>gawk</code>程序的报告生成能力通常用来从大文件文本中提取数据元素，并将它们格式化成可读的报告。其中最完美的例子是格式化日志文件。</p>
<h3 id="gawk简单应用"><a href="#gawk简单应用" class="headerlink" title="gawk简单应用"></a><code>gawk</code>简单应用</h3><h4 id="gawk命令格式"><a href="#gawk命令格式" class="headerlink" title="gawk命令格式"></a><code>gawk</code>命令格式</h4><p><code>gawk</code>程序的基本格式如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gawk options program file</span><br></pre></td></tr></table></figure>
<p>下面是<code>gawk</code>程序的一些可用选项</p>
<ol>
<li><code>-F fs</code>。指定行中划分数据字段的分段分隔符。</li>
<li><code>-f file</code>。从指定文件中读取程序。</li>
<li><code>-v var=value</code>。定义<code>gawk</code>程序中的一个变量及其默认值。</li>
<li><code>-mf N</code>。指定要处理的数据文件中的最大字段数。</li>
<li><code>-mr N</code>。指定数据文件中的最大数据行数。</li>
<li><code>-W keyword</code>。指定<code>gawk</code>的兼容模式或警告等级。</li>
</ol>
<p><code>gawk</code>的强大之处在于程序脚本。可以写脚本来读取文本行的数据，然后处理并显示数据，创建任何类型的输出报告。</p>
<h4 id="从命令行读取程序脚本"><a href="#从命令行读取程序脚本" class="headerlink" title="从命令行读取程序脚本"></a>从命令行读取程序脚本</h4><p><code>gawk</code>程序脚本用一对花括号来定义。必须将脚本命令放到两个花括号中。由于<code>gawk</code>命令行假定脚本是单个文本字符串，必须将脚本放到单引号中。下面是一个例子</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gawk <span class="string">&#x27;&#123;print &quot;Hello World!&quot;&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>上面的例子使用了<code>print</code>命令，它会打印输出到<code>STDOUT</code>中，但是因为上面的命令没有指定文件，它会从<code>STDIN</code>读取输入。在运行的过程中它会一直等待<code>STDIN</code>的输入文本。如果输入一行文本然后按下回车键，<code>gawk</code>就会运行指定的脚本，在这个例子中就是打印一行<code>Hello World!</code>。</p>
<h4 id="使用数据字段变量"><a href="#使用数据字段变量" class="headerlink" title="使用数据字段变量"></a>使用数据字段变量</h4><p><code>gawk</code>会自动给一行中的每个数据元素分配一个变量。默认情况下，<code>gawk</code>会将如下变量分配给它在文本行中发现的数据字段。</p>
<ol>
<li><code>$0</code>代表整个文本行</li>
<li><code>$1</code>代表文本行中的第一个数据字段</li>
<li><code>$n</code>代表文本行中的第n个数据字段</li>
</ol>
<p>在文本行中，每个数据字段都是通过字段分隔符划分的。<code>gawk</code>在读取一行文本时会用预定的字段分隔符划分每个数据字段。默认的时任意的空白字符。下面是一个例子</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ cat data2.txt</span><br><span class="line">One line of <span class="built_in">test</span> text.</span><br><span class="line">Tow line of <span class="built_in">test</span> text.</span><br><span class="line">Three line of <span class="built_in">test</span> text.</span><br><span class="line">$ gawk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> data2.txt</span><br><span class="line">One</span><br><span class="line">Tow</span><br><span class="line">Three</span><br><span class="line">$ gawk -F: <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> /etc/passwd</span><br><span class="line">root</span><br><span class="line">daemon</span><br><span class="line">bin</span><br><span class="line">sys</span><br><span class="line">sync</span><br><span class="line">games</span><br><span class="line">man</span><br><span class="line">lp</span><br><span class="line">mail</span><br><span class="line">news</span><br><span class="line">uucp</span><br><span class="line">[...]</span><br></pre></td></tr></table></figure>
<h4 id="在程序脚本中使用多个命令"><a href="#在程序脚本中使用多个命令" class="headerlink" title="在程序脚本中使用多个命令"></a>在程序脚本中使用多个命令</h4><p>和<code>sed</code>类似，可以使用加分号和多行两种方式。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;My name is Rich&quot;</span> | gawk <span class="string">&#x27;&#123;$4=&quot;Christine&quot;; print $0&#125;&#x27;</span></span><br><span class="line">My name is Christine</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;My name is Rich&quot;</span> | gawk <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">&gt; $4=&quot;Christine&quot;</span></span><br><span class="line"><span class="string">&gt; print $0&#125;&#x27;</span></span><br><span class="line">My name is Christine</span><br></pre></td></tr></table></figure>
<h4 id="从文件中读取程序"><a href="#从文件中读取程序" class="headerlink" title="从文件中读取程序"></a>从文件中读取程序</h4><p>使用<code>-f</code>命令就可以指定文件。下面是一个例子</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ cat script3.gawk</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">test</span> = <span class="string">&quot;&#x27;s home directory is &quot;</span></span><br><span class="line"><span class="built_in">print</span> <span class="variable">$1</span> <span class="built_in">test</span> <span class="variable">$6</span></span><br><span class="line">&#125;</span><br><span class="line">$ gawk -F: -f script3.gawk /etc/passwd</span><br><span class="line">root<span class="string">&#x27;s home directory is /root</span></span><br><span class="line"><span class="string">daemon&#x27;</span>s home directory is /usr/sbin</span><br><span class="line">bin<span class="string">&#x27;s home directory is /bin</span></span><br><span class="line"><span class="string">sys&#x27;</span>s home directory is /dev</span><br><span class="line">sync<span class="string">&#x27;s home directory is /bin</span></span><br><span class="line"><span class="string">games&#x27;</span>s home directory is /usr/games</span><br><span class="line">[...]</span><br><span class="line">$ </span><br></pre></td></tr></table></figure>
<p>这里需要注意<code>gawk</code>程序在引用变量值时并未像shell脚本一样使用美元符。</p>
<h4 id="在处理数据前后运行脚本"><a href="#在处理数据前后运行脚本" class="headerlink" title="在处理数据前后运行脚本"></a>在处理数据前后运行脚本</h4><p>可以使用<code>BEGIN</code>关键字和<code>END</code>关键字来分别定义在数据处理前后的行为。下面时一个例子</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">$ cat script4.gawk</span><br><span class="line">BEGIN &#123;</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;The latest list of users and shells&quot;</span></span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot; UserID \t Shell&quot;</span></span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;------- \t ---------&quot;</span></span><br><span class="line">FS=<span class="string">&quot;:&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">print</span> <span class="variable">$1</span> <span class="string">&quot;   \t    &quot;</span> <span class="variable">$7</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">END &#123;</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;This concludes the listing&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">$ gawk -f script4.gawk /etc/passwd</span><br><span class="line">The latest list of users and shells</span><br><span class="line"> UserID          Shell</span><br><span class="line">-------          ---------</span><br><span class="line">root        /bin/bash</span><br><span class="line">daemon              /usr/sbin/nologin</span><br><span class="line">bin         /usr/sbin/nologin</span><br><span class="line">sys         /usr/sbin/nologin</span><br><span class="line">sync        /bin/sync</span><br><span class="line">games               /usr/sbin/nologin</span><br><span class="line">$ </span><br></pre></td></tr></table></figure>
<h2 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h2><h3 id="正则表达式类型"><a href="#正则表达式类型" class="headerlink" title="正则表达式类型"></a>正则表达式类型</h3><p>在linux中，有两种流行的正则表达式引擎：</p>
<ol>
<li>POSIX基础正则表达式（BRE）引擎</li>
<li>POSIX扩展正则表达式（ERE）引擎</li>
</ol>
<p><code>sed</code>编辑器符合BRE引擎，使用ERE引擎对应的符号需要使用转义，<code>gawk</code>程序用ERE引擎来处理它的正则表达式。</p>
<h3 id="定义BRE模式"><a href="#定义BRE模式" class="headerlink" title="定义BRE模式"></a>定义BRE模式</h3><h4 id="纯文本"><a href="#纯文本" class="headerlink" title="纯文本"></a>纯文本</h4><p>简单的文本匹配，不包含特殊字符。</p>
<h4 id="特殊字符"><a href="#特殊字符" class="headerlink" title="特殊字符"></a>特殊字符</h4><p>正则表达式识别的特殊字符包括<code>.*[]^$&#123;&#125;\+?|()</code>。如果需要以纯文本模式匹配这些字符，需要使用<code>\</code>进行转义。例如</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;The cost is \$4.00&quot;</span> | sed -n <span class="string">&#x27;/\$/p&#x27;</span></span><br><span class="line">The cost is <span class="variable">$4</span>.00</span><br><span class="line">$ </span><br></pre></td></tr></table></figure>
<p>最后，尽管<code>/</code>不是一个特殊字符，但是在<code>sed</code>和<code>gawk</code>中使用时仍然需要转义。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;3 / 2&quot;</span> | sed -n <span class="string">&#x27;/\//p&#x27;</span></span><br><span class="line">3 / 2</span><br><span class="line">$ </span><br></pre></td></tr></table></figure>
<h4 id="锚字符"><a href="#锚字符" class="headerlink" title="锚字符"></a>锚字符</h4><ol>
<li><p>锁定在行首。<code>^</code>定义从数据流中文本行的行首开始的模式，会在每个由换行符决定的新数据行的行首检查模式。如果将<code>^</code>放到模式开头之外的其他位置，那它就跟普通字符一样，不再是特殊字符。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;sdas ^&quot;</span> | sed -n <span class="string">&#x27;/^/p&#x27;</span></span><br><span class="line">sdas ^</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;sdas ^&quot;</span> | sed -n <span class="string">&#x27;/s ^/p&#x27;</span></span><br><span class="line">sdas ^</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;sdas ^&quot;</span> | sed -n <span class="string">&#x27;/^s/p&#x27;</span></span><br><span class="line">sdas ^</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;sdas ^&quot;</span> | sed -n <span class="string">&#x27;/^a/p&#x27;</span></span><br><span class="line">$ </span><br></pre></td></tr></table></figure></li>
<li><p>锁定在行尾。<code>$</code>定义从数据流中文本行的行首开始的模式。和<code>^</code>完全类似。</p>
</li>
<li><p>组合使用。如果<code>^</code>和<code>$</code>组合使用，表示匹配只包含中间内容的行，特别的<code>^$</code>可以用来匹配空行。</p>
</li>
</ol>
<h4 id="点号字符"><a href="#点号字符" class="headerlink" title="点号字符"></a>点号字符</h4><p><code>.</code>用来匹配除了换行符之外的任意单个字符。它必须匹配一个字符。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;at&quot;</span> | sed -n <span class="string">&#x27;/.at/p&#x27;</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot; at&quot;</span> | sed -n <span class="string">&#x27;/.at/p&#x27;</span></span><br><span class="line"> at</span><br><span class="line">$ </span><br></pre></td></tr></table></figure>
<h4 id="字符组"><a href="#字符组" class="headerlink" title="字符组"></a>字符组</h4><p>使用方括号<code>[]</code>来定义一个字符组。方括号中包含所有希望出现在改字符组中的字符。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;Yes&quot;</span> | sed -n <span class="string">&#x27;/[Yy][Ee][Ss]/p&#x27;</span></span><br><span class="line">Yes</span><br><span class="line">$ </span><br></pre></td></tr></table></figure>
<h4 id="排除型字符组"><a href="#排除型字符组" class="headerlink" title="排除型字符组"></a>排除型字符组</h4><p>在字符组的开头加上<code>^</code>可以反转字符组，去匹配没有在字符组中出现的字符。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;hat&quot;</span> | sed -n <span class="string">&#x27;/[^ch]at/p&#x27;</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;at&quot;</span> | sed -n <span class="string">&#x27;/[^ch]at/p&#x27;</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot; at&quot;</span> | sed -n <span class="string">&#x27;/[^ch]at/p&#x27;</span></span><br><span class="line"> at</span><br><span class="line">$ </span><br></pre></td></tr></table></figure>
<h4 id="区间"><a href="#区间" class="headerlink" title="区间"></a>区间</h4><p>可以使用单破折线符号<code>-</code>在字符组中表示字符。例如<code>[1-9][a-g][a-ch-m]</code>。</p>
<h4 id="特殊字符组"><a href="#特殊字符组" class="headerlink" title="特殊字符组"></a>特殊字符组</h4><table>
<thead>
<tr>
<th align="center">组</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">[[:alpha:]]</td>
<td align="center">a-z,A-Z</td>
</tr>
<tr>
<td align="center">[[:alnum:]]</td>
<td align="center">0-9,a-z,A-Z</td>
</tr>
<tr>
<td align="center">[[:blank:]]</td>
<td align="center">空格或者制表符</td>
</tr>
<tr>
<td align="center">[[:digit:]]</td>
<td align="center">0-9</td>
</tr>
<tr>
<td align="center">[[:lower:]]</td>
<td align="center">a-z</td>
</tr>
<tr>
<td align="center">[[:upper:]]</td>
<td align="center">A-Z</td>
</tr>
<tr>
<td align="center">[[:print:]]</td>
<td align="center">任意可打印字符</td>
</tr>
<tr>
<td align="center">[[:punct:]]</td>
<td align="center">标点符号</td>
</tr>
<tr>
<td align="center">[[:space:]]</td>
<td align="center">任意空白字符</td>
</tr>
</tbody></table>
<h4 id="星号"><a href="#星号" class="headerlink" title="星号"></a>星号</h4><p>在字符后面放置型号<code>*</code>表明该字符必须在匹配模式的文本中出现0次或者多次（注意这里和通配符<code>*</code>是不同的，不能混淆）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;ik&quot;</span> | sed -n <span class="string">&#x27;/ie*k/p&#x27;</span></span><br><span class="line">ik</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;ieeeeek&quot;</span> | sed -n <span class="string">&#x27;/ie*k/p&#x27;</span></span><br><span class="line">ieeeeek</span><br></pre></td></tr></table></figure>
<h3 id="扩展正则表达式"><a href="#扩展正则表达式" class="headerlink" title="扩展正则表达式"></a>扩展正则表达式</h3><p>注意这里属于ERE的范畴，也就是说<code>sed</code>需要转义，<code>gawk</code>支持。</p>
<h4 id="问号"><a href="#问号" class="headerlink" title="问号"></a>问号</h4><p><code>?</code>表明前面出现的字符可以出现0次或者1次，<code>sed</code>中需要使用<code>\?</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;bt&quot;</span> | gawk <span class="string">&#x27;/be?t/&#123;print $0&#125;&#x27;</span></span><br><span class="line">bt</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;bt&quot;</span> | sed -n <span class="string">&#x27;/be\?t/p&#x27;</span></span><br><span class="line">bt</span><br><span class="line">$ </span><br></pre></td></tr></table></figure>
<h4 id="加号"><a href="#加号" class="headerlink" title="加号"></a>加号</h4><p><code>+</code>表示前面的字符出现1次或者多次，<code>sed</code>中使用<code>\+</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;bt&quot;</span> | gawk <span class="string">&#x27;/be+t/&#123;print $0&#125;&#x27;</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;bet&quot;</span> | gawk <span class="string">&#x27;/be+t/&#123;print $0&#125;&#x27;</span></span><br><span class="line">bet</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;bet&quot;</span> | sed -n <span class="string">&#x27;/be\+t/p&#x27;</span></span><br><span class="line">bet</span><br><span class="line">$ </span><br></pre></td></tr></table></figure>
<h4 id="使用花括号"><a href="#使用花括号" class="headerlink" title="使用花括号"></a>使用花括号</h4><p>花括号允许为可重复的正则表达式指定一个上限。有两种形式</p>
<ol>
<li><code>&#123;m&#125;</code>。表示准确出现m次。</li>
<li><code>&#123;m,n&#125;</code>。表示至少出现m次，至多出现n次。</li>
<li><code>&#123;m,&#125;</code>。至少出现m次。</li>
</ol>
<p>注意<code>gawk</code>程序默认不识别。必须指定<code>--re-interval</code>。注意在<code>sed</code>编辑器中是支持花括号的，只是需要使用转义<code>\&#123;m\&#125;</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;bt&quot;</span> | gawk --re-interval <span class="string">&#x27;/be&#123;1&#125;t/&#123;print $0&#125;&#x27;</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;bet&quot;</span> | gawk --re-interval <span class="string">&#x27;/be&#123;1&#125;t/&#123;print $0&#125;&#x27;</span></span><br><span class="line">bet</span><br><span class="line">$ </span><br></pre></td></tr></table></figure>
<h4 id="管道符号"><a href="#管道符号" class="headerlink" title="管道符号"></a>管道符号</h4><p>管道符号<code>|</code>相当于逻辑OR，只要两边的模式有一个匹配即可。同样<code>sed</code>中使用<code>\|</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;I&#x27;m a dog&quot;</span> | gawk <span class="string">&#x27;/dog|cat/&#123;print $0&#125;&#x27;</span></span><br><span class="line">I<span class="string">&#x27;m a dog</span></span><br><span class="line"><span class="string">$ echo &quot;I&#x27;</span>m a cat<span class="string">&quot; | gawk &#x27;/dog|cat/&#123;print <span class="variable">$0</span>&#125;&#x27;</span></span><br><span class="line"><span class="string">I&#x27;m a cat</span></span><br><span class="line"><span class="string">$ echo &quot;</span>I<span class="string">&#x27;m a bird&quot; | gawk &#x27;</span>/dog|cat/&#123;<span class="built_in">print</span> <span class="variable">$0</span>&#125;<span class="string">&#x27;</span></span><br><span class="line"><span class="string">$ echo &quot;I&#x27;</span>m a dog<span class="string">&quot; | sed -n &#x27;/dog\|cat/p&#x27;</span></span><br><span class="line"><span class="string">I&#x27;m a dog</span></span><br><span class="line"><span class="string">$ echo &quot;</span>I<span class="string">&#x27;m a cat&quot; | sed -n &#x27;</span>/dog\|cat/p<span class="string">&#x27;</span></span><br><span class="line"><span class="string">I&#x27;</span>m a cat</span><br><span class="line">$ </span><br></pre></td></tr></table></figure>
<h4 id="表达式分组"><a href="#表达式分组" class="headerlink" title="表达式分组"></a>表达式分组</h4><p>可以使用圆括号<code>()</code>进行分组。当使用分组时，该组合被当作一个字符，可以使用<code>?+</code>等特殊字符。注意在<code>sed</code>中也是支持圆括号的，需要使用转义<code>\(\)</code>在<code>sed</code>中，会保持<code>\(\)</code>匹配的字符，可以使用<code>\1</code>进行提取，如果有多个<code>\(\)</code>都匹配成功，则使用<code>\2 \3</code>进行提取。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;Saturday&quot;</span> | gawk <span class="string">&#x27;/Sat(urday)?/&#123;print $0&#125;&#x27;</span></span><br><span class="line">Saturday</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;Sat&quot;</span> | gawk <span class="string">&#x27;/Sat(urday)?/&#123;print $0&#125;&#x27;</span></span><br><span class="line">Sat</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;Sat&quot;</span> | sed -n <span class="string">&#x27;&#123;/Sat\(urday\)\&#123;0,1\&#125;/p;&#125;&#x27;</span></span><br><span class="line">Sat</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;Saturday&quot;</span> | sed -n <span class="string">&#x27;&#123;/Sat\(urday\)\&#123;0,1\&#125;/p;&#125;&#x27;</span></span><br><span class="line">Saturday</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;&#123;1234567&#125;&quot;</span>|sed <span class="string">&#x27;s/&#123;\([0-9]*\)&#125;/\1/&#x27;</span></span><br><span class="line">1234567</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;Yes&quot;</span> | sed  <span class="string">&#x27;s!\(Y\|y\)\(E\|e\)\(S\|s\)!\3!&#x27;</span></span><br><span class="line">s</span><br><span class="line">$ </span><br></pre></td></tr></table></figure>
</div><div class="article-licensing box"><div class="licensing-title"><p>sed,gawk基础与正则表达式</p><p><a href="https://afawa.github.io/2021/01/19/sed,gawk基础与正则表达式/">https://afawa.github.io/2021/01/19/sed,gawk基础与正则表达式/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>Yiming He</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2021-01-19</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2021-01-20</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a class="icon" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a><a class="icon" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/linux-command-line/">linux command line</a></div><div class="sharethis-inline-share-buttons"></div><script src="https://platform-api.sharethis.com/js/sharethis.js#property=5ff82d83d7d501001255ad9d&amp;product=sticky-share-buttons" defer></script></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2021/01/21/sed-gawk%E8%BF%9B%E9%98%B6/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">sed,gawk进阶</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2021/01/19/shell%E8%84%9A%E6%9C%AC%E4%B8%AD%E4%BD%BF%E7%94%A8%E5%87%BD%E6%95%B0/"><span class="level-item">shell脚本中使用函数</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">Comments</h3><div id="comment-container"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.6.2/dist/gitalk.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@1.6.2/dist/gitalk.min.js"></script><script>var gitalk = new Gitalk({
            id: "832bdab58a258d1e555187426593fe74",
            repo: "afawa.github.io",
            owner: "afawa",
            clientID: "ad49fd64876339d5ddc6",
            clientSecret: "c34cd6c177e1310c81d20ff9b5efea8c05b1a546",
            admin: ["afawa"],
            createIssueManually: false,
            distractionFreeMode: false,
            perPage: 10,
            pagerDirection: "last",
            
            
            enableHotKey: true,
            
        })
        gitalk.render('comment-container')</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="level is-mobile" href="#sed基础，gawk基础，正则表达式"><span class="level-left"><span class="level-item">1</span><span class="level-item">sed基础，gawk基础，正则表达式</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#sed-编辑器"><span class="level-left"><span class="level-item">1.1</span><span class="level-item">sed 编辑器</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#sed简单应用"><span class="level-left"><span class="level-item">1.1.1</span><span class="level-item">sed简单应用</span></span></a></li><li><a class="level is-mobile" href="#sed编辑器基础"><span class="level-left"><span class="level-item">1.1.2</span><span class="level-item">sed编辑器基础</span></span></a></li></ul></li><li><a class="level is-mobile" href="#gawk-程序"><span class="level-left"><span class="level-item">1.2</span><span class="level-item">gawk 程序</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#gawk简单应用"><span class="level-left"><span class="level-item">1.2.1</span><span class="level-item">gawk简单应用</span></span></a></li></ul></li><li><a class="level is-mobile" href="#正则表达式"><span class="level-left"><span class="level-item">1.3</span><span class="level-item">正则表达式</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#正则表达式类型"><span class="level-left"><span class="level-item">1.3.1</span><span class="level-item">正则表达式类型</span></span></a></li><li><a class="level is-mobile" href="#定义BRE模式"><span class="level-left"><span class="level-item">1.3.2</span><span class="level-item">定义BRE模式</span></span></a></li><li><a class="level is-mobile" href="#扩展正则表达式"><span class="level-left"><span class="level-item">1.3.3</span><span class="level-item">扩展正则表达式</span></span></a></li></ul></li></ul></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/linux-command-line/"><span class="level-start"><span class="level-item">linux command line</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/programming-language/"><span class="level-start"><span class="level-item">programming language</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="Yiming&#039;s Blog" height="28"></a><p class="is-size-7"><span>&copy; 2021 Yiming He</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" async></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>